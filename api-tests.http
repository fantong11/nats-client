### NATS Client API Tests
### 
### 完整的NATS Client Service API測試集合
### 包含本地和Kubernetes環境的測試
### 
### 環境變量設置：
### @baseUrl = http://localhost:8080              # 本地開發
### @k8sUrl = http://localhost:30080              # Kubernetes NodePort
### @minikubeUrl = http://192.168.49.2:30080     # Minikube (替換為實際IP)

### ===========================================
### 本地開發環境測試
### ===========================================

### 1. 健康檢查
GET {{baseUrl}}/actuator/health
Accept: application/json

### 2. Swagger UI 檢查
GET {{baseUrl}}/swagger-ui.html
Accept: text/html

### 3. OpenAPI 文檔
GET {{baseUrl}}/v3/api-docs
Accept: application/json

### 4. 發布消息 (JetStream)
POST {{baseUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.local.publish",
  "payload": {
    "message": "Hello from local development!",
    "timestamp": "{{$datetime iso8601}}",
    "environment": "local",
    "feature": "JetStream publish"
  }
}

### 5. 請求響應測試 (有回音服務)
POST {{baseUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "test.echo",
  "payload": {
    "message": "Hello Echo from local!",
    "requestId": "local-test-001",
    "timestamp": "{{$datetime iso8601}}"
  }
}

### 6. 請求響應測試 (無回音服務 - 會超時)
POST {{baseUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "test.no.response",
  "payload": {
    "message": "This will timeout",
    "requestId": "timeout-test-001"
  }
}

### 7. 測試回音功能
POST {{baseUrl}}/api/nats/test/echo
Content-Type: application/json

{
  "message": "Hello Echo Test!",
  "metadata": "local-test-metadata"
}

### 8. 測試超時處理
POST {{baseUrl}}/api/nats/test/timeout
Content-Type: application/json

### 9. 測試錯誤處理
POST {{baseUrl}}/api/nats/test/error
Content-Type: application/json

### 10. 查看統計信息
GET {{baseUrl}}/api/nats/statistics
Accept: application/json

### 11. 查詢請求狀態 (根據請求ID)
GET {{baseUrl}}/api/nats/status/req-test-001
Accept: application/json

### 12. 查詢請求狀態 (根據相關ID)
GET {{baseUrl}}/api/nats/status/correlation/CORR-test-001
Accept: application/json

### 13. 根據狀態查詢請求列表
GET {{baseUrl}}/api/nats/requests/SUCCESS
Accept: application/json

### 14. 查看失敗的請求
GET {{baseUrl}}/api/nats/requests/FAILED
Accept: application/json

### 15. 服務健康狀態
GET {{baseUrl}}/api/nats/health
Accept: application/json

### ===========================================
### Kubernetes 環境測試 (NodePort)
### ===========================================

### 16. K8s 健康檢查
GET {{k8sUrl}}/actuator/health
Accept: application/json

### 17. K8s Swagger UI 檢查
GET {{k8sUrl}}/swagger-ui.html
Accept: text/html

### 18. K8s 發布消息測試
POST {{k8sUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.k8s.publish",
  "payload": {
    "message": "Hello from Kubernetes deployment!",
    "timestamp": "{{$datetime iso8601}}",
    "environment": "kubernetes",
    "nodePort": 30080
  }
}

### 19. K8s 請求響應測試
POST {{k8sUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "test.echo",
  "payload": {
    "message": "Hello Echo from K8s!",
    "requestId": "k8s-test-001",
    "timestamp": "{{$datetime iso8601}}",
    "cluster": "minikube"
  }
}

### 20. K8s 統計信息查詢
GET {{k8sUrl}}/api/nats/statistics
Accept: application/json

### 21. K8s 健康狀態檢查
GET {{k8sUrl}}/api/nats/health
Accept: application/json

### ===========================================
### Minikube 環境測試 (使用實際IP)
### ===========================================

### 22. Minikube 發布消息測試
POST {{minikubeUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.minikube.publish",
  "payload": {
    "message": "Hello from Minikube!",
    "timestamp": "{{$datetime iso8601}}",
    "environment": "minikube",
    "cluster": "local-minikube"
  }
}

### 23. Minikube 請求測試
POST {{minikubeUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "test.echo",
  "payload": {
    "message": "Hello Echo from Minikube!",
    "requestId": "minikube-test-001"
  }
}

### ===========================================
### 批量測試和性能測試
### ===========================================

### 24. 批量發布測試 (用於生成統計數據)
POST {{baseUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.batch.publish",
  "payload": {
    "message": "Batch test message 1",
    "batchId": 1,
    "timestamp": "{{$datetime iso8601}}"
  }
}

### 25. 批量發布測試 2
POST {{baseUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.batch.publish",
  "payload": {
    "message": "Batch test message 2",
    "batchId": 2,
    "timestamp": "{{$datetime iso8601}}"
  }
}

### 26. 批量發布測試 3
POST {{baseUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.batch.publish",
  "payload": {
    "message": "Batch test message 3",
    "batchId": 3,
    "timestamp": "{{$datetime iso8601}}"
  }
}

### ===========================================
### 錯誤測試場景
### ===========================================

### 27. 無效的Subject測試 (空字符串)
POST {{baseUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "",
  "payload": {
    "message": "Invalid subject test"
  }
}

### 28. 缺少Payload測試
POST {{baseUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "test.missing.payload"
}

### 29. 無效JSON測試
POST {{baseUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.invalid.json",
  "payload": "invalid json structure"

### ===========================================
### 特殊功能測試
### ===========================================

### 30. 大負載測試
POST {{baseUrl}}/api/nats/publish
Content-Type: application/json

{
  "subject": "test.large.payload",
  "payload": {
    "message": "Large payload test",
    "data": "{{$randomLoremText}}",
    "largeArray": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
    "metadata": {
      "size": "large",
      "timestamp": "{{$datetime iso8601}}",
      "testId": "{{$guid}}"
    }
  }
}

### 31. 自定義相關ID測試
POST {{baseUrl}}/api/nats/request
Content-Type: application/json

{
  "subject": "test.echo",
  "payload": {
    "message": "Custom correlation ID test",
    "requestId": "custom-corr-test"
  }
}

### 32. JSON對象響應測試
POST {{baseUrl}}/api/nats/test/echo
Content-Type: application/json

{
  "message": "JSON response test",
  "metadata": "response-format-test"
}

### ===========================================
### 監控和診斷
### ===========================================

### 33. 檢查所有成功的請求
GET {{baseUrl}}/api/nats/requests/SUCCESS
Accept: application/json

### 34. 檢查所有待處理的請求
GET {{baseUrl}}/api/nats/requests/PENDING
Accept: application/json

### 35. 檢查所有超時的請求
GET {{baseUrl}}/api/nats/requests/TIMEOUT
Accept: application/json

### 36. 最終統計信息檢查
GET {{baseUrl}}/api/nats/statistics
Accept: application/json

### ===========================================
### 環境變量定義 (在測試前設置)
### ===========================================

### 設置環境變量
@baseUrl = http://localhost:8080
@k8sUrl = http://localhost:30080
@minikubeUrl = http://192.168.49.2:30080

###